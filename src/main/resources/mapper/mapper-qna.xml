<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.site.mapper.QnaMapper">
	<!-- qna 전체리스트 호출 -->
	<select id="selectQnaList" resultType="com.site.vo.QnaVo">
		<![CDATA[	
			SELECT *
			FROM
			(
				SELECT ROWNUM AS RNUM, A.*
				FROM
				(
					SELECT Q.*, U.NAME AS QNA_NAME
					FROM   QNA Q, USERS U
                    WHERE Q.EMAIL = U.EMAIL
					ORDER BY Q.QNA_GROUP DESC, Q.QNA_STEP
				) A
			)
			WHERE RNUM >= #{startRow}
			AND	  RNUM <= #{endRow}
	    ]]>
	</select>
	
	<!-- qna 전체글 수 -->
	<select id="selectQnaCount" resultType="int">
		SELECT COUNT(*)
		FROM   QNA
	</select>
	
	<!-- qna all로 검색한 리스트 호출 -->
	<select id="selectQnaListSearchAll" resultType="com.site.vo.QnaVo">
		<![CDATA[
			SELECT *
			FROM
			(
				SELECT ROWNUM AS RNUM, A.*
				FROM
				(
					SELECT Q.*, U.NAME AS QNA_NAME
					FROM   QNA Q, USERS U
                    WHERE Q.EMAIL = U.EMAIL
                    AND   (U.NAME LIKE '%' || #{search} || '%'
                    OR     Q.QNA_TITLE LIKE '%' || #{search} || '%'
                    OR     Q.QNA_CONTENT LIKE '%' || #{search} || '%')
					ORDER BY Q.QNA_GROUP DESC, Q.QNA_STEP
				) A
			)
			WHERE RNUM >= #{startRow}
			AND	  RNUM <= #{endRow}
	    ]]>
	</select>
	
	<!-- qna all로 검색한 수 -->
	<select id="selectQnaSearchAllCount" resultType="int">
		<![CDATA[   
	      SELECT COUNT(*)
	      FROM   QNA Q, USERS U
	      WHERE  Q.EMAIL = U.EMAIL
	      AND    (Q.QNA_TITLE LIKE '%' || #{search} || '%'
	      OR	  Q.QNA_CONTENT LIKE '%' || #{search} || '%'
	      OR	  U.NAME LIKE '%' || #{search} || '%')
	    ]]>
	</select>
	
	<!-- qna category별 검색한 리스트 호출 -->
	<select id="selectQnaListSearch" resultType="com.site.vo.QnaVo">
		<![CDATA[
			SELECT *
			FROM
			(
				SELECT ROWNUM AS RNUM, A.*
				FROM
				(
					SELECT Q.*, U.NAME AS QNA_NAME
					FROM   QNA Q, USERS U
					WHERE  Q.EMAIL = U.EMAIL
		]]>
		<choose>
			<when test="category=='qna_title'">		<!-- 제목별 검색 -->
				<![CDATA[			
					AND Q.QNA_TITLE LIKE '%' || #{search} || '%'
			    ]]>
	    	</when>
	    	<when test="category=='qna_content'">	<!-- 내용별 검색 -->
				<![CDATA[		
					AND Q.QNA_CONTENT LIKE '%' || #{search} || '%'
			    ]]>
	    	</when>
	    	<when test="category=='qna_name'">		<!-- 이름별 검색 -->
				<![CDATA[
					AND U.NAME LIKE '%' || #{search} || '%'	
			    ]]>
	    	</when>
	    </choose>
	    	<![CDATA[
	    			ORDER BY Q.QNA_GROUP DESC, Q.QNA_STEP
	    			) A
				)
			WHERE RNUM >= #{startRow}
			AND	  RNUM <= #{endRow}
			]]>
	</select>
	
	<!-- qna category별 검색한 수 -->
	<select id="selectQnaSearchCount" resultType="int">
		<![CDATA[   
			SELECT COUNT(*)
			FROM   QNA Q, USERS U
			WHERE  Q.EMAIL = U.EMAIL
	    ]]>
	    <choose>
			<when test="category=='qna_title'">		<!-- 제목별 검색 --> 
				<![CDATA[ 
					AND Q.QNA_TITLE LIKE '%' || #{search} || '%'
		    	]]>
	    	</when>
	    	<when test="category=='qna_content'">	<!-- 내용별 검색 --> 
				<![CDATA[ 
					AND Q.QNA_CONTENT LIKE '%' || #{search} || '%'
		    	]]>
	    	</when>
	    	<when test="category=='qna_name'">		<!-- 이름별 검색 --> 
				<![CDATA[ 
					AND U.NAME LIKE '%' || #{search} || '%'
		    	]]>
	    	</when>
	    </choose>
	</select>
	
</mapper>